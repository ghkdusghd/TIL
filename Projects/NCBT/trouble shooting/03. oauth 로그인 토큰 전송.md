> oauth 로그인을 구현하면서 겪은 시행착오를 정리해본다.

### 🚀 사전 정리

### 🔥 문제 상황

### ✨ 해결

1. 오어스 로그인 로직을 헷갈렸다. 프론트 >> 서버 >> 인증서버 로 요청해야 했는데, 프론트 >> 인증서버 ? 로 바로 요청하니까 스프링에서 처리가 안됐음.

2. 이걸 고치니까 스프링에서 생성한 토큰 및 로그인 정보를 어케 보내야할지 모르게 되어버림. >> 아 그럼 컨트롤러를 거쳐야 하나? 그치만 "/" 경로로 axios 요청을 보내봐도 에러가 뜨는데... >> 생각해보니 cors 테스트를 하려고 "/" 경로를 미리 만들어놨던걸 잊어버리고 있었다. 그래서 그걸 주석처리하고 "login/naver" 경로로 get 요청한 결과 문제 없이 통신하는 것을 확인했다.

3. 그렇다면 이제 스프링에서 인증 서버로 요청이 가야하는데. 이걸 어떻게 할 것인가? 이전 프로젝트 코드들을 참고해보니 스프링에서 restTemplete 이라는 HTTP 통신 도구를 제공하고 있음을 알았다.

4. 더 구현하다보니 스프링 시큐리티에서 네이버 로그인 과정을 자동으로 처리해주는 것은 맞지만, 그것은 내수용(?)으로 쓸 때 가능하고, 리액트와 통신하기 위해서는 직접 구현해야 했다.

5. 스프링에서 제공하는 restTemplate 클래스는 헤더를 직접 설정하려면 ReseponseEntity 를 반환하는 exchange() 메서드를 사용해야 한다. 이참에 http 통신에 대해서 공부하게 되었다...

6. 근데 이렇게 스프링에서 헤더로 전송한 토큰에 접근할 수가 없었다. response 받은 값을 콘솔에 찍어보았는데 헤더에 있어야 할 토큰값이 안보였고, 여기서 type="cors" 라는 텍스트가 보였는데 뭔가 쎄하긴 했지만 계속 시도해보았다. 그래도 잘 되지 않았음.

<img src="../images/스크린샷 2024-10-17 오전 11.47.32.png">

근데 찾아본 결과, cors 에러가 원인인 것 같았다. cors 때문에 헤더에 접근하는 것에 제한이 걸리고, 추가적인 설정을 해주지 않으면 몇몇 standard 한 값만 보이는 것이다...그래서 서버 측에서 설정을 추가했다. config.addExposedHeader("Authorization"); 단 한 줄 추가... 코스 에러 다 잡았다고 생각했는데 뒷통수 맞은 느낌...
